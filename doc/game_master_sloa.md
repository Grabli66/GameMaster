# Алгоритм работы гейм мастера (Game Master SLOA)

## Общее описание
Гейм мастер (Game Master) - это модуль, который управляет игровым процессом, используя локальные модели LLM (Small Local OpenAI API). Он отвечает за создание и управление игровыми сценами, персонажами и их взаимодействием.

## Основные компоненты

### Структуры данных
1. **GameMaster** - основной класс мастера игры:
   - AI API для взаимодействия с моделями
   - Мир (World)
   - Текущая сцена (Scene)
   - Ввод пользователя

2. **SceneStoryBatch** - пакет данных сцены:
   - Текст начала сцены
   - Экземпляр GameMaster
   - Персонажи с их действиями

3. **PersonWithActions** - персонаж с набором действий:
   - Персонаж (Person)
   - Последовательность действий (PersonAction)

## Алгоритм работы

### 1. Инициализация
1. Создание нового GameMaster:
   - Проверка доступных моделей
   - Выбор подходящей модели из списка разрешенных
   - Инициализация мира и текущей сцены

### 2. Запуск игры
1. Создание описания локации
2. Генерация начального описания сцены (предистория)
3. Создание SceneStoryBatch с начальным состоянием

### 3. Начало сцены
1. Определение инициативы персонажей:
   - Бросок инициативы для каждого персонажа
2. Сортировка персонажей по инициативе
3. Генерация действий для каждого персонажа:
   - Получение сенсорного восприятия персонажа
   - Генерация возможных действий
   - Принятие решения

### 4. Обработка действий
1. Получение ввода пользователя
2. Разбор ввода на атомарные действия
3. Обновление состояния сцены

### 5. Завершение сцены
1. Сбор истории сцены
2. Возврат финального описания

## Особенности работы с AI
1. Использование промптов для:
   - Генерации описаний локаций
   - Создания действий персонажей
   - Обработки сенсорного восприятия
2. Настройки генерации:
   - Температура = 0.0 для детерминированных результатов
   - Ограничение на количество токенов
   - Отключение потокового вывода

## Поддерживаемые модели
- gemma-3-4b-it
- ruadaptqwen2.5-14b-instruct-1m
